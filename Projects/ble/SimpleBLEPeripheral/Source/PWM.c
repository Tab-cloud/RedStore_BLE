#include "pwm.h"
#include <ioCC2540.h> 
/*******************************************************************************************************************/
/****************************************************Define ********************************************************/
/*******************************************************************************************************************/
//#ifdef BV
//#define BV(n)           (1<<(n))
//#endif

static u8 sPwm_P11 = 0;
/*******************************************************************************************************************/
/************************************************* Function Code ***************************************************/
/*******************************************************************************************************************/
//PWM初始化
void PWM_Init(void)
{
  P1DIR |= BV(1);                                //P11定义为输出 
  P1SEL |= BV(1);                                //将P11设置为外设功能;
  
  T4CTL = 0x00;                                  //1分频（32M/256=125K）、关timer、自由运行模式
  
  T4CC1 = 255 - sPwm_P11;                        //P11的初始化值 
  T4CCTL1 = 0x2C;                                //00 101 100无中断、Set output on compare, clear on 0xFF、比较模式、No Capture   
  
  T4CTL |= BV(4);                                //开始定时器
}

//设置PWM值
void PWM_Set(u8 nPWM)
{
  sPwm_P11 = nPWM;
}

//PWM 更新值
void PWM_Pulse(void)
{
  //重新配置PWM值
  T4CC1 = 255 - sPwm_P11;
  
  //复位timer4的counter
  T4CTL &= ~BV(2);
  
  //使能定时器4
  T4CTL |= BV(4); 
}
